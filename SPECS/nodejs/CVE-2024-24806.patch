From 330c76424a32cff2ab67a44aa121d4a37b65ac2b Mon Sep 17 00:00:00 2001
From: Suresh Thelkar <sthelkar@microsoft.com>
Date: Mon, 19 Feb 2024 11:22:20 +0530
Subject: [PATCH] Patch for CVE-2024-24806

Upstream patch details are given below
https://github.com/libuv/libuv/commit/0f2d7e784a256b54b2385043438848047bc2a629
---
 deps/uv/src/idna.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/deps/uv/src/idna.c b/deps/uv/src/idna.c
index b44cb16a..84df0ad3 100644
--- a/deps/uv/src/idna.c
+++ b/deps/uv/src/idna.c
@@ -307,8 +307,10 @@ long uv__idna_toascii(const char* s, const char* se, char* d, char* de) {
       return rc;
   }
 
-  if (d < de)
-    *d++ = '\0';
+  if (d >= de)
+    return UV_EINVAL;
+
+  *d++ = '\0';
 
   return d - ds;  /* Number of bytes written. */
 }
-- 
2.34.1

